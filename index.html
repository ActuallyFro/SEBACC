<!-- Create page with a text area, which can be searched for the word "foundme", that is updated in a results box .innerHTML -->
<html>
<head>
<title>SEBACC - Space Engineers Block And Component Calculator</title>
</head>

<!-- load jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Load scripts on Pageload -->
  
<body>
  <h1>SEBACC - Space Engineers Block And Component Calculator</h2>
  <h2>1. Paste BluePrint Text Here</h2>
  <p>
  <!-- editable textarea, with default placeholder text 'here' -->
  <textarea id="bp-textarea" rows="10" cols="50" placeholder="Paste your SBC file contents here..."></textarea>
  </p>

  <h2>2. Press GO</h2>
  <!-- Button which runs calculateBACC() function-->
  <button onclick="calculateBACC()">GO</button>
  <p>
  </p>

  <script>
    // script function BACC(),  updates 'result' textarea with text 'example'
    function calculateBACC() {

      // //https://stackoverflow.com/questions/16991341/json-parse-file-path
      // var request = new XMLHttpRequest();
      // request.open("GET", "./Blocks.json", false);
      // request.send(null)
      // var my_JSON_object = JSON.parse(request.responseText);
      // alert (my_JSON_object.result[0]);

      // var xmlhttp = new XMLHttpRequest();
      // xmlhttp.onreadystatechange = function() {
      // if (this.readyState == 4 && this.status == 200) {
      //   var myObj = JSON.parse(this.responseText);
      //     document.getElementById("demo").innerHTML = myObj.name;
      //   }
      // };
      // xmlhttp.open("GET", "json_demo.txt", true);
      // xmlhttp.send();

      var request = new XMLHttpRequest();
      request.open("GET","Blocks.json", false);
      request.send(null);
      var jsonData = JSON.parse(request.responseText);

      //debug to see if data is loaded:
      // console.log(jsonData);

      var BluePrintText = $('#bp-textarea').val();

      // // count the number of "SubtypeName" in the text
      // var SubtypeCount = (BluePrintText.match(/SubtypeName/g) || []).length;

      // empty array to store strings, called "Blocks"
      var Blocks = [];

      // https://www.w3schools.com/xml/tryit.asp?filename=try_dom_loadxmltext
      parseXMLTags= new DOMParser();
      xmlDoc = parseXMLTags.parseFromString(BluePrintText,"text/xml");

      //Get all nodeValues of the "SubtypeName" tags
      var Blocks = xmlDoc.getElementsByTagName("SubtypeName");
      //used in example as: xmlDoc.getElementsByTagName("title")[0].childNodes[0].nodeValue;

      //Iterate over all blocks, look up their costs in the Blocks.json file, and add them to the total
      var BlocksString = "";

      //Hashmap to store the block costs; key is the block name, value is the cost
      var BlockCosts = {};
      
      for (var i = 0; i < Blocks.length; i++) {
        //Access the 'Cost' data fron jsonData
        // var BlockCost = jsonData.result[i].Cost;

        // //get ields in json data:
        // var BlockCost = jsonData.Blocks[i].Cost;
        
        // //print the block name and cost to the console
        // for (var ii = 0; ii < BlockCost.length; ii++) {
        //   console.log(Blocks[i].innerHTML + ": " + BlockCost[ii]);
        // }
        
//iterate over jsonData, print object to console


//         for (var ii = 0; ii < jsonData.length; ii++) {
//           var BlockVal = jsonData[ii];
//           if (Blocks[i].innerHTML == jsonData.result[ii].Name) {
//             //add the cost to the total
//             // BlocksString += Blocks[i].innerHTML + ": " + jsonData.result[ii].Cost + "\n";
//             BlockCosts[Blocks[i].innerHTML] = jsonData.result[ii].Cost;
//           }
//         }



        // BlockCosts[Blocks[i].childNodes[0].nodeValue] = 0;
        BlocksString += Blocks[i].innerHTML + ", ";
      }
      // remove trailing comma
      BlocksString = BlocksString.substring(0, BlocksString.length - 2);

      document.getElementById("result").innerHTML = "SUPER AWESOME BACC result; Found Blocks: {" + BlocksString + "}";
    }
  </script>
  

  <h2>3. Profit??? (Calculation Result)</h2>
  <!-- Calculation TextArea that's updated by Javascript -->
  <textarea id="result" rows="10" cols="50" placeholder="Calculation Result"></textarea>

  <p>
  </p>


  
  </body>
</html>